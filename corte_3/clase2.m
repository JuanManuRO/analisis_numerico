clear all
clc
a = [2.11 -4.21 0.921;
    4.01 10.2 -1.12;
    1.09 0.987 0.832];
b = [2.01; -3.09; 4.21];

S = max(abs(a), [], 2);

[M, i] = max(a(:,1)./abs(S));
a([1,i],:) = a([i,1],:);
b([1,i],:) = b([i,1],:);
S([1,i],:) = S([i,1],:);

m21 = a(2,1)/a(1,1);
a(2,:) = a(2,:) - m21*a(1,:);
b(2,:) = b(2,:) - m21*b(1,:);

m31 = a(3,1)/a(1,1);
a(3,:) = a(3,:) - m31*a(1,:);
b(3,:) = b(3,:) - m31*b(1,:);



[M, i] = max(abs(a(2:end,2))./abs(S(2:end)));
i = i+1;
a([2,i],:) = a([i,2],:);
b([2,i],:) = b([i,2],:);
S([2,i],:) = S([i,2],:);

m32 = a(3,2)/a(2,2);
a(3,:) = a(3,:) - m32*a(2,:);
b(3,:) = b(3,:) - m32*b(2,:);

x3 = b(3) / a(3,3)
x2 = (b(2) - a(2,3)*x3)/a(2,2)
x1 = (b(1) - a(1,3)*x3 - a(1,2)*x2)/a(1,1)
